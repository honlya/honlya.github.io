<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>统一门户问题处理 | Gridea</title>
<link rel="shortcut icon" href="https://honlya.github.io/favicon.ico?v=1659319384223">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://honlya.github.io/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="统一门户问题处理 | Gridea - Atom Feed" href="https://honlya.github.io/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



    <meta name="description" content="** 1.ORA-14450**
NED处理中心推送出现这个问题
select 'alter system kill session '''||a.sid||','||a.SERIAL#||''';' from Vsessionawhere..." />
    <meta name="keywords" content="" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://honlya.github.io">
  <img class="avatar" src="https://honlya.github.io/images/avatar.png?v=1659319384223" alt="">
  </a>
  <h1 class="site-title">
    Gridea
  </h1>
  <p class="site-description">
    温故而知新
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          首页
        </a>
      
    
      
        <a href="/archives" class="menu">
          归档
        </a>
      
    
      
        <a href="/tags" class="menu">
          标签
        </a>
      
    
      
        <a href="/post/about" class="menu">
          关于
        </a>
      
    
      
        <a href="https://getgridea.github.io/archives" class="menu">
          统一门户日常问题
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              统一门户问题处理
            </h2>
            <div class="post-info">
              <span>
                2022-07-28
              </span>
              <span>
                9 min read
              </span>
              
            </div>
            
              <img class="post-feature-image" src="https://honlya.github.io/post-images/tong-yi-men-hu-wen-ti-chu-li.png" alt="">
            
            <div class="post-content-wrapper">
              <div class="post-content" v-pre>
                <p>** 1.ORA-14450**</p>
<p>NED处理中心推送出现这个问题<br>
select 'alter system kill session '''||a.sid||','||a.SERIAL#||''';' from V<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>a</mi><mi>w</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>S</mi><mi>I</mi><mi>D</mi><mi>i</mi><mi>n</mi><mo>(</mo><mi>S</mi><mi>E</mi><mi>L</mi><mi>E</mi><mi>C</mi><mi>T</mi><mi>S</mi><mi>I</mi><mi>D</mi><mi>F</mi><mi>R</mi><mi>O</mi><mi>M</mi><mi>v</mi></mrow><annotation encoding="application/x-tex">session a 
 where SID in (SELECT SID FROM v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span></span></span>enqueue_lock t WHERE t.type='TO');------查出    查出来的语句复制执行<br>
后台推送  存储 importop_task  测试   填入id  reporttastdetailid<br>
** 2.动态SQL**</p>
<p>select bp.buname as BU,h.sellercode as 经销商代码,h.sellername as 经销商名称,h.originalcustname as 原始客户名称,h.buyercode as 客户代码,h.buyername as 客户名称,sysdate as &quot;导出时间（系统时间）&quot;,null as &quot;是否有曾用名（网站或官网）&quot;,null as 曾用名代码,null as 曾用名名称 from historyofsales h,organization o,buproduct bp where<br>
h.salesdate&gt;=to_date(v_parameter2,'yyyy-mm-dd') and h.salesdate&lt;=to_date(v_parameter3,'yyyy-mm-dd') and h.buyerid = o.orgid<br>
and o.createdate&gt;=to_date(v_parameter4,'yyyy-mm-dd HH24:mi:ss') and o.createdate&lt;=to_date(v_parameter5,'yyyy-mm-dd HH24:mi:ss')<br>
and h.prodid=bp.prodid and bp.bucode = 'v_parameter1'<br>
group by bp.buname,h.sellercode,h.sellername,h.originalcustname,h.buyercode,h.buyername</p>
<p>select bu.bucode as p_value,bu.buname as p_name from bumaster bu where bu.butype = 2 and bu.status = 41 and bu.parentbucode is not null and bu.datasource is not null and bu.datasource not in ('XJP','MSD','BLG','SGB')</p>
<p><strong>3.直连平台报错500</strong></p>
<p>​           select u.regioncode,u.regionname from ddiuser u group by u.regioncode,u.regionname having count(1)&gt;1</p>
<p>查找出重复的 删除<br>
<strong>4.同义词</strong></p>
<p>create or replace synonym gatherplandetail<br>
for gatherplandetail@link230_unportal;</p>
<h3 id="5报错ora-14450ned">5.报错ORA-14450(NED)</h3>
<p>第一步</p>
<p>select SID,SERIAL# from V<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>w</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>S</mi><mi>I</mi><mi>D</mi><mi>i</mi><mi>n</mi><mo>(</mo><mi>s</mi><mi>e</mi><mi>l</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>s</mi><mi>i</mi><mi>d</mi><mi>f</mi><mi>r</mi><mi>o</mi><mi>m</mi><mi>v</mi></mrow><annotation encoding="application/x-tex">session where SID in (select sid from v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mopen">(</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">o</span><span class="mord mathdefault">m</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span></span></span>enqueue_lock t where t.type='TO')<br>
alter system kill session '103,257';</p>
<p>第二步</p>
<p>importtophcp_task  存储   &quot;测试&quot;</p>
<p>select * from PUSHREPORTTASTDETAIL t where t.bucode = '196 ALK' order by t.datalastupdate desc--查询BU对应的ID,填到存储里测试</p>
<p>196 ALK是BU   需要上载的文件</p>
<h3 id="6创建job定时任务">6.创建JOB,定时任务</h3>
<p>declare</p>
<pre><code> job NUMBER;
</code></pre>
<p>begin<br>
sys.dbms_job.submit(job =&gt; job,<br>
what =&gt; 'PRC_UCBDTP_GYLK01;',<br>
next_date =&gt; to_date('28-12-2021 05:00:00', 'dd-mm-yyyy hh24:mi:ss'),<br>
interval =&gt; 'trunc(sysdate+1)+5/24');<br>
commit;<br>
end;</p>
<h3 id="7数据库服务器文件储存地址">7.数据库服务器文件储存地址</h3>
<p>create or replace directory  DIR_GZYY01_EXCEL  as '/u02/backup/UCBDTP';</p>
<h3 id="8上载审批处理人员出错删除">8.上载审批，处理人员出错，删除</h3>
<p>select * from feedbacktrack f where f.sellercode = '059208' order by f.createdate desc for update</p>
<h3 id="9-申诉上载错误">9. 申诉上载错误</h3>
<p>select * from feedbacktrack fd where fd.createdate =to_date( '2021/12/16 7:53:21','yyyy/mm/dd hh:mi:ss') order by fd.createdate desc for update</p>
<h3 id="10黑名单维护">10.黑名单维护</h3>
<p>select * from blacklist bl order by bl.createdate desc  --自检<br>
insert into blacklist (blacklistid ,bucode ,dtcode,dtname ,attr1 )<br>
select blacklistseq.nextval,bucode ,dtcode,dtname,'202112' from blacklist where attr1='201806'<br>
-- 如上12月黑名单</p>
<h3 id="11期间是否正常">11.期间是否正常</h3>
<p>select * from historyofsales hs where hs.POSTDATE&gt;=to_date('2021-02-01','yyyy-mm-dd')</p>
<h3 id="12月数据自补是否打开">12.月数据自补是否打开</h3>
<p>select optionvalue  from orgoption a where optionname='DDIFILE_SUPPLYMENT_PROJECT_TRTTE';</p>
<h3 id="13dtp药房直连数据自动拆分">13.DTP药房直连数据自动拆分</h3>
<p>select * from UCBORGMAPPING t for update</p>
<h3 id="14统一门户批量卸载文件">14.统一门户批量卸载文件</h3>
<p>--第一步<br>
drop table DEL1<br>
/<em>select * from purchasedatafile p where<br>
select * from inventorydatafile i where</em>/</p>
<p>--第二步<br>
select * from DEL1<br>
CREATE TABLE DEL1 AS<br>
select * from salesdatafile f where f.filename  in(<br>
'SD_H570AJ_温州九州通医药有限公司_20211020_DD_TRTTE_ALL自补_155.csv',<br>
'SD_H570AJ_温州九州通医药有限公司_20211013_DD_TRTTE_ALL自补_162.csv',<br>
'SD_H570AJ_温州九州通医药有限公司_20211015_DD_TRTTE_ALL自补_161.csv',<br>
'SD_H570AJ_温州九州通医药有限公司_20211022_DD_TRTTE_ALL自补_160.csv',<br>
'SD_H570AJ_温州九州通医药有限公司_20211112_DD_TRTTE_ALL自补_159.csv')</p>
<p>--第三步<br>
drop table DEL2<br>
CREATE TABLE DEL2 AS SELECT * FROM DATAFILEDETAIL D WHERE D.DATAFILEID IN(SELECT E.REFFILEID FROM DEL1 E);<br>
select * from DEL2</p>
<p>--第四步<br>
declare v_message varchar2(256);<br>
BEGIN<br>
FOR C1 IN(SELECT * FROM DEL2 D WHERE D.DATAFILEDETAILID&lt;&gt;100758687) LOOP<br>
begin<br>
call_dcfiledelete(v_message ,/*DATAFILEDETAILid */C1.DATAFILEDETAILID,/*userid */100005783,'CHC',172);</p>
<p>update originalsalesdata  set deleteflag = 'Y',<br>
reasondeletion=172,<br>
uninstallmaker=100005783,<br>
uninstalldate=sysdate where  datafiledetailid in (C1.CAHDATAFILEDETAILID) and deleteflag is null;</p>
<p>update datafiledetail set status=50  where datafiledetailid =C1.CAHDATAFILEDETAILID;</p>
<p>update salesdatafile a set a.filestatus=50 where reffileid in (C1.CAHDATAFILEDETAILID);<br>
commit;<br>
end;<br>
END LOOP;<br>
END ;</p>
<p>select * from usr u where u.userid = 100005783 --uninstallmaker对应userid</p>
<h3 id="15删除产品对照">15.删除产品对照</h3>
<p>delete from prodcollate p where p.prodcollateid in (<br>
101056448</p>
<p>)</p>
<h3 id="16对照删除">16.对照删除</h3>
<p>-- 临时表<br>
delete from org_temp<br>
--插入商业代码 orgcode<br>
select * from org_temp for update<br>
--查找临时表中数据数量是否与excel中一致<br>
select count(1) from org_temp<br>
--查找organization表，当临时表中code与之相同的 倒序查出<br>
select o.orgid,o.orgcode from organization o,org_temp ot where o.orgcode = ot.orgcode order by o.orgcode desc<br>
-- 查出orgid，通过客户代码查出dtid 同样方式</p>
<p>delete from orgnamecollatetemp --临时表<br>
--依次插入<br>
select om.dtid,om.orgname,om.orgid from orgnamecollatetemp om for update<br>
-- 查找确认<br>
select count(1) from orgnamecollate om where exists(select 1 from orgnamecollatetemp ot where ot.dtid = om.dtid and ot.orgname = om.orgname and ot.orgid = om.orgid)--3857</p>
<p>create table orgnamecollate0222del as select * from orgnamecollate om where exists(select 1 from orgnamecollatetemp ot where ot.dtid = om.dtid and ot.orgname = om.orgname and ot.orgid = om.orgid)</p>
<p>select count(1) from orgnamecollate0222del--3857<br>
delete from orgnamecollate om where exists(select 1 from orgnamecollate0222del om2 where om.orgnamecollateid = om2.orgnamecollateid)--3857</p>
<p>select * from orgnamecollate0222del</p>
<p>select count(1) from orgcodecollate oc where exists(select 1 from orgnamecollatetemp ot where ot.dtid = oc.dtid and ot.orgname = oc.orgcode and ot.orgid = oc.orgid)--3853<br>
create table orgcodecollate0222del as select * from orgcodecollate oc where exists(select 1 from orgnamecollatetemp ot where ot.dtid = oc.dtid and ot.orgname = oc.orgcode and ot.orgid = oc.orgid)--3853<br>
-- 删除<br>
delete from orgcodecollate oc where exists (select 1 from orgcodecollate0222del oc2 where oc2.orgcodecollateid = oc.orgcodecollateid)</p>
<p>select * from orgcodecollate0222del</p>
<h3 id="17pfm特例">17.PFM特例</h3>
<p>select * from customerspecialpfm</p>
<h3 id="18统一门户文件整体流程">18.统一门户文件整体流程</h3>
<p>--DDI原始文件表头</p>
<p>select * from historyofsales h where h.HISTORYOFSALESID = 447636561<br>
select * from ddidatafiledetail dd where  dd.filename like 'SD_KF5355_上海邻客道客大药房有限公司_20220515_DD_DQYY_All%'</p>
<p>--DDI原始文件明细  销售 SD<br>
select * from ddioriginalsalesdata ds where ds.datafiledetailid = 125083859 --3597288188 originalsalesdataid<br>
--DDI原始文件明细  库存 ID<br>
select * from ddioriginalinventorydata ds where ds.datafiledetailid = 124959696<br>
--DDI原始文件明细  采购 PD<br>
select * from DDIORIGINALINVENTORYDATA ds where ds.datafiledetailid = 124959696</p>
<p>select * from historyofinventory v where v.CHAORIID=122035054</p>
<p>--拆分后<br>
--是去了哪？原始流向表么？originalsalesdata？<br>
--拆分之前有别的操作么？<br>
--拆分之后是去了哪张表，整体结束到各个数据中心在操作？<br>
select * from datafiledetail dd where dd.filename like 'SD_KF5355_上海邻客道客大药房有限公司_20220515_DD_DQYY%'--for update<br>
select * from datafiledetail  where datafileid=122504677<br>
select * from originalinventorydata o where datafiledetailid = 122391781<br>
select * from originalsalesdata where datafiledetailid = 122496230<br>
select * from originalpurchasedata where originalpurchasedataid = 121533170<br>
select * from salesdatafile where rownum&lt;10 105227756 SD_HW6112_国药控股(乐山)川药医药有限公司_20200429_DD_DSCN_ALL_99.xlsx<br>
select * from originalsalesdata t  where t.salesdatafileid= 105227756</p>
<p>-- 查询文件 例如 销售<br>
select * from salesdatafile sa where sa.reffileid=115881514  --可根据filename查看<br>
select * from inventorydatafile ia where ia.filename like 'ID_002118_国药控股分销中心有限公司_20220505_DD_BIIB%'<br>
select * from datafileactionlog da where da.datafiledetailid=124959696 --文件状态 ：21失败  50卸载  10刚入</p>
<p>-- 不反写之前数据 状态10改为80<br>
--select * from orgcodecollate org where org.status=10<br>
update orgcodecollate org set org.status=80 where org.status=10</p>
<p>10  输入,</p>
<p>11  文件规则失败,</p>
<p>12  文件名检查失败,</p>
<p>13	文件备份失败,</p>
<p>20	数据保存成功,</p>
<p>21	数据保存失败,</p>
<p>40	标记删除,</p>
<p>50	卸载,</p>
<p>79	文件名检查失败,</p>
<p>100	HSR下发药厂成功</p>
<p>--第二步：<br>
-- datafiledetailid 121081945   --datafileid 121090005<br>
select * from datafiledetail  where filename like 'ID_HR1727_中山广药桂康医药有限公司_20220506_DD_SZXB_ALL%'  order by datafiledetailid  desc<br>
-- salesdatafileid 107209963<br>
select * from salesdatafile  where filename like '%SM_079104_江西南华医药有限公司_20220401_DD_SZXB_ALL自补%'<br>
select * from inventorydatafile where filename like '%ID_HK6719_老百姓大药房连锁股份有限公司_20220410_DD_SZXB%'<br>
select * from purchasedatafile where filename like '%PD_002826_国药集团西南医药有限公司_20210413_DD_BIIB_ALL%'</p>
<p>--第三步：<br>
--originalsalesdataid   就是流向表中的统一门户id<br>
select * from originalsalesdata where datafiledetailid =122164242  --文件明细id<br>
select * from originalsalesdata where salesdatafileid   =107571171  --文件流向id<br>
select * from originalsalesdata where originalsalesdataid =107570836  --统一门户id</p>
<p>select * from originalinventorydata a where a.inventorydatafileid = 100472935--122035054<br>
select o.expirydate from originalpurchasedata o where o.datafiledetailid =119342239  --文件明细id</p>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li>
<ul>
<li>
<ul>
<li><a href="#5%E6%8A%A5%E9%94%99ora-14450ned">5.报错ORA-14450(NED)</a></li>
<li><a href="#6%E5%88%9B%E5%BB%BAjob%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1">6.创建JOB,定时任务</a></li>
<li><a href="#7%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%96%87%E4%BB%B6%E5%82%A8%E5%AD%98%E5%9C%B0%E5%9D%80">7.数据库服务器文件储存地址</a></li>
<li><a href="#8%E4%B8%8A%E8%BD%BD%E5%AE%A1%E6%89%B9%E5%A4%84%E7%90%86%E4%BA%BA%E5%91%98%E5%87%BA%E9%94%99%E5%88%A0%E9%99%A4">8.上载审批，处理人员出错，删除</a></li>
<li><a href="#9-%E7%94%B3%E8%AF%89%E4%B8%8A%E8%BD%BD%E9%94%99%E8%AF%AF">9. 申诉上载错误</a></li>
<li><a href="#10%E9%BB%91%E5%90%8D%E5%8D%95%E7%BB%B4%E6%8A%A4">10.黑名单维护</a></li>
<li><a href="#11%E6%9C%9F%E9%97%B4%E6%98%AF%E5%90%A6%E6%AD%A3%E5%B8%B8">11.期间是否正常</a></li>
<li><a href="#12%E6%9C%88%E6%95%B0%E6%8D%AE%E8%87%AA%E8%A1%A5%E6%98%AF%E5%90%A6%E6%89%93%E5%BC%80">12.月数据自补是否打开</a></li>
<li><a href="#13dtp%E8%8D%AF%E6%88%BF%E7%9B%B4%E8%BF%9E%E6%95%B0%E6%8D%AE%E8%87%AA%E5%8A%A8%E6%8B%86%E5%88%86">13.DTP药房直连数据自动拆分</a></li>
<li><a href="#14%E7%BB%9F%E4%B8%80%E9%97%A8%E6%88%B7%E6%89%B9%E9%87%8F%E5%8D%B8%E8%BD%BD%E6%96%87%E4%BB%B6">14.统一门户批量卸载文件</a></li>
<li><a href="#15%E5%88%A0%E9%99%A4%E4%BA%A7%E5%93%81%E5%AF%B9%E7%85%A7">15.删除产品对照</a></li>
<li><a href="#16%E5%AF%B9%E7%85%A7%E5%88%A0%E9%99%A4">16.对照删除</a></li>
<li><a href="#17pfm%E7%89%B9%E4%BE%8B">17.PFM特例</a></li>
<li><a href="#18%E7%BB%9F%E4%B8%80%E9%97%A8%E6%88%B7%E6%96%87%E4%BB%B6%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B">18.统一门户文件整体流程</a></li>
</ul>
</li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">下一篇</div>
            <a href="https://honlya.github.io/post/hello-gridea/">
              <h3 class="post-title">
                Hello Gridea
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
  <a class="rss" href="https://honlya.github.io/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
